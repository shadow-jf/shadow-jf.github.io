"use strict";(self.webpackChunkwebpack_web=self.webpackChunkwebpack_web||[]).push([[958],{7958:(nt,F,b)=>{b.d(F,{$:()=>f});var c=b(2923),l=b(3994),G=b(1384),W=b(8619),Z=b(7745),M=b(8146),m=b(5222),x=b(2407),N="tr-konva",B=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange"].map(d=>d+`.${N}`).join(" "),D="nodesRect",I=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"],z={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135};const L="ontouchstart"in m.So._global;function U(d,t){if(d==="rotater")return"crosshair";t+=c.Z.degToRad(z[d]||0);var e=(c.Z.radToDeg(t)%360+360)%360;return c.Z._inRange(e,315+22.5,360)||c.Z._inRange(e,0,22.5)?"ns-resize":c.Z._inRange(e,45-22.5,45+22.5)?"nesw-resize":c.Z._inRange(e,90-22.5,90+22.5)?"ew-resize":c.Z._inRange(e,135-22.5,135+22.5)?"nwse-resize":c.Z._inRange(e,180-22.5,180+22.5)?"ns-resize":c.Z._inRange(e,225-22.5,225+22.5)?"nesw-resize":c.Z._inRange(e,270-22.5,270+22.5)?"ew-resize":c.Z._inRange(e,315-22.5,315+22.5)?"nwse-resize":(c.Z.error("Transformer has unknown angle for cursor detection: "+e),"pointer")}var A=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"],R=1e8;function X(d){return{x:d.x+d.width/2*Math.cos(d.rotation)+d.height/2*Math.sin(-d.rotation),y:d.y+d.height/2*Math.cos(d.rotation)+d.width/2*Math.sin(d.rotation)}}function T(d,t,e){const o=e.x+(d.x-e.x)*Math.cos(t)-(d.y-e.y)*Math.sin(t),i=e.y+(d.x-e.x)*Math.sin(t)+(d.y-e.y)*Math.cos(t);return Object.assign(Object.assign({},d),{rotation:d.rotation+t,x:o,y:i})}function Y(d,t){const e=X(d);return T(d,t,e)}function K(d,t,e){let o=t;for(let i=0;i<d.length;i++){const n=m.So.getAngle(d[i]),s=Math.abs(n-t)%(Math.PI*2);Math.min(s,Math.PI*2-s)<e&&(o=n)}return o}class f extends M.Z{constructor(t){super(t),this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(B,this.update),this.getNode()&&this.update()}attachTo(t){return this.setNode(t),this}setNode(t){return c.Z.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([t])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return N+this._id}setNodes(t=[]){this._nodes&&this._nodes.length&&this.detach(),this._nodes=t,t.length===1&&this.useSingleNodeRotation()?this.rotation(t[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(o=>{const i=()=>{this.nodes().length===1&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),!this._transforming&&!this.isDragging()&&this.update()},n=o._attrsAffectingSize.map(s=>s+"Change."+this._getEventNamespace()).join(" ");o.on(n,i),o.on(I.map(s=>s+`.${this._getEventNamespace()}`).join(" "),i),o.on(`absoluteTransformChange.${this._getEventNamespace()}`,i),this._proxyDrag(o)}),this._resetTransformCache();var e=!!this.findOne(".top-left");return e&&this.update(),this}_proxyDrag(t){let e;t.on(`dragstart.${this._getEventNamespace()}`,o=>{e=t.getAbsolutePosition(),!this.isDragging()&&t!==this.findOne(".back")&&this.startDrag(o,!1)}),t.on(`dragmove.${this._getEventNamespace()}`,o=>{if(!e)return;const i=t.getAbsolutePosition(),n=i.x-e.x,s=i.y-e.y;this.nodes().forEach(r=>{if(r===t||r.isDragging())return;const a=r.getAbsolutePosition();r.setAbsolutePosition({x:a.x+n,y:a.y+s}),r.startDrag(o)}),e=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(t=>{t.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(D),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(D,this.__getNodeRect)}__getNodeShape(t,e=this.rotation(),o){var i=t.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),n=t.getAbsoluteScale(o),s=t.getAbsolutePosition(o),r=i.x*n.x-t.offsetX()*n.x,a=i.y*n.y-t.offsetY()*n.y;const u=(m.So.getAngle(t.getAbsoluteRotation())+Math.PI*2)%(Math.PI*2),_={x:s.x+r*Math.cos(u)+a*Math.sin(-u),y:s.y+a*Math.cos(u)+r*Math.sin(u),width:i.width*n.x,height:i.height*n.y,rotation:u};return T(_,-m.So.getAngle(e),{x:0,y:0})}__getNodeRect(){var t=this.getNode();if(!t)return{x:-R,y:-R,width:0,height:0,rotation:0};const e=[];this.nodes().map(u=>{const _=u.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()});var h=[{x:_.x,y:_.y},{x:_.x+_.width,y:_.y},{x:_.x+_.width,y:_.y+_.height},{x:_.x,y:_.y+_.height}],S=u.getAbsoluteTransform();h.forEach(function(y){var g=S.point(y);e.push(g)})});const o=new c.w;o.rotate(-m.So.getAngle(this.rotation()));var i,n,s,r;e.forEach(function(u){var _=o.point(u);i===void 0&&(i=s=_.x,n=r=_.y),i=Math.min(i,_.x),n=Math.min(n,_.y),s=Math.max(s,_.x),r=Math.max(r,_.y)}),o.invert();const a=o.point({x:i,y:n});return{x:a.x,y:a.y,width:s-i,height:r-n,rotation:m.So.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),A.forEach(function(t){this._createAnchor(t)}.bind(this)),this._createAnchor("rotater")}_createAnchor(t){var e=new Z.U({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:t+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:L?10:"auto"}),o=this;e.on("mousedown touchstart",function(i){o._handleMouseDown(i)}),e.on("dragstart",i=>{e.stopDrag(),i.cancelBubble=!0}),e.on("dragend",i=>{i.cancelBubble=!0}),e.on("mouseenter",()=>{var i=m.So.getAngle(this.rotation()),n=U(t,i);e.getStage().content&&(e.getStage().content.style.cursor=n),this._cursorChange=!0}),e.on("mouseout",()=>{e.getStage().content&&(e.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(e)}_createBack(){var t=new W.b({name:"back",width:0,height:0,draggable:!0,sceneFunc(e){var o=this.getParent(),i=o.padding();e.beginPath(),e.rect(-i,-i,this.width()+i*2,this.height()+i*2),e.moveTo(this.width()/2,-i),o.rotateEnabled()&&e.lineTo(this.width()/2,-o.rotateAnchorOffset()*c.Z._sign(this.height())-i),e.fillStrokeShape(this)},hitFunc:(e,o)=>{if(!!this.shouldOverdrawWholeArea()){var i=this.padding();e.beginPath(),e.rect(-i,-i,o.width()+i*2,o.height()+i*2),e.fillStrokeShape(o)}}});this.add(t),this._proxyDrag(t),t.on("dragstart",e=>{e.cancelBubble=!0}),t.on("dragmove",e=>{e.cancelBubble=!0}),t.on("dragend",e=>{e.cancelBubble=!0}),this.on("dragmove",e=>{this.update()})}_handleMouseDown(t){this._movingAnchorName=t.target.name().split(" ")[0];var e=this._getNodeRect(),o=e.width,i=e.height,n=Math.sqrt(Math.pow(o,2)+Math.pow(i,2));this.sin=Math.abs(i/n),this.cos=Math.abs(o/n),typeof window!="undefined"&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;var s=t.target.getAbsolutePosition(),r=t.target.getStage().getPointerPosition();this._anchorDragOffset={x:r.x-s.x,y:r.y-s.y},this._fire("transformstart",{evt:t.evt,target:this.getNode()}),this._nodes.forEach(a=>{a._fire("transformstart",{evt:t.evt,target:a})})}_handleMouseMove(t){var e,o,i,n=this.findOne("."+this._movingAnchorName),s=n.getStage();s.setPointersPositions(t);const r=s.getPointerPosition();let a={x:r.x-this._anchorDragOffset.x,y:r.y-this._anchorDragOffset.y};const u=n.getAbsolutePosition();this.anchorDragBoundFunc()&&(a=this.anchorDragBoundFunc()(u,a,t)),n.setAbsolutePosition(a);const _=n.getAbsolutePosition();if(!(u.x===_.x&&u.y===_.y)){if(this._movingAnchorName==="rotater"){var h=this._getNodeRect();e=n.x()-h.width/2,o=-n.y()+h.height/2;let P=Math.atan2(-o,e)+Math.PI/2;h.height<0&&(P-=Math.PI);var S=m.So.getAngle(this.rotation());const tt=S+P,et=m.So.getAngle(this.rotationSnapTolerance()),it=K(this.rotationSnaps(),tt,et)-h.rotation,ot=Y(h,it);this._fitNodesInto(ot,t);return}var y=this.keepRatio()||t.shiftKey,O=this.centeredScaling()||t.altKey;if(this._movingAnchorName==="top-left"){if(y){var g=O?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};i=Math.sqrt(Math.pow(g.x-n.x(),2)+Math.pow(g.y-n.y(),2));var v=this.findOne(".top-left").x()>g.x?-1:1,p=this.findOne(".top-left").y()>g.y?-1:1;e=i*this.cos*v,o=i*this.sin*p,this.findOne(".top-left").x(g.x-e),this.findOne(".top-left").y(g.y-o)}}else if(this._movingAnchorName==="top-center")this.findOne(".top-left").y(n.y());else if(this._movingAnchorName==="top-right"){if(y){var g=O?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};i=Math.sqrt(Math.pow(n.x()-g.x,2)+Math.pow(g.y-n.y(),2));var v=this.findOne(".top-right").x()<g.x?-1:1,p=this.findOne(".top-right").y()>g.y?-1:1;e=i*this.cos*v,o=i*this.sin*p,this.findOne(".top-right").x(g.x+e),this.findOne(".top-right").y(g.y-o)}var w=n.position();this.findOne(".top-left").y(w.y),this.findOne(".bottom-right").x(w.x)}else if(this._movingAnchorName==="middle-left")this.findOne(".top-left").x(n.x());else if(this._movingAnchorName==="middle-right")this.findOne(".bottom-right").x(n.x());else if(this._movingAnchorName==="bottom-left"){if(y){var g=O?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};i=Math.sqrt(Math.pow(g.x-n.x(),2)+Math.pow(n.y()-g.y,2));var v=g.x<n.x()?-1:1,p=n.y()<g.y?-1:1;e=i*this.cos*v,o=i*this.sin*p,n.x(g.x-e),n.y(g.y+o)}w=n.position(),this.findOne(".top-left").x(w.x),this.findOne(".bottom-right").y(w.y)}else if(this._movingAnchorName==="bottom-center")this.findOne(".bottom-right").y(n.y());else if(this._movingAnchorName==="bottom-right"){if(y){var g=O?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};i=Math.sqrt(Math.pow(n.x()-g.x,2)+Math.pow(n.y()-g.y,2));var v=this.findOne(".bottom-right").x()<g.x?-1:1,p=this.findOne(".bottom-right").y()<g.y?-1:1;e=i*this.cos*v,o=i*this.sin*p,this.findOne(".bottom-right").x(g.x+e),this.findOne(".bottom-right").y(g.y+o)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));var O=this.centeredScaling()||t.altKey;if(O){var C=this.findOne(".top-left"),E=this.findOne(".bottom-right"),H=C.x(),$=C.y(),V=this.getWidth()-E.x(),J=this.getHeight()-E.y();E.move({x:-H,y:-$}),C.move({x:V,y:J})}var k=this.findOne(".top-left").getAbsolutePosition();e=k.x,o=k.y;var Q=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),q=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:e,y:o,width:Q,height:q,rotation:m.So.getAngle(this.rotation())},t)}}_handleMouseUp(t){this._removeEvents(t)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(t){if(this._transforming){this._transforming=!1,typeof window!="undefined"&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));var e=this.getNode();this._fire("transformend",{evt:t,target:e}),e&&this._nodes.forEach(o=>{o._fire("transformend",{evt:t,target:o})}),this._movingAnchorName=null}}_fitNodesInto(t,e){var o=this._getNodeRect();const i=1;if(c.Z._inRange(t.width,-this.padding()*2-i,i)){this.update();return}if(c.Z._inRange(t.height,-this.padding()*2-i,i)){this.update();return}const n=this.flipEnabled();var s=new c.w;if(s.rotate(m.So.getAngle(this.rotation())),this._movingAnchorName&&t.width<0&&this._movingAnchorName.indexOf("left")>=0){const h=s.point({x:-this.padding()*2,y:0});if(t.x+=h.x,t.y+=h.y,t.width+=this.padding()*2,this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=h.x,this._anchorDragOffset.y-=h.y,!n){this.update();return}}else if(this._movingAnchorName&&t.width<0&&this._movingAnchorName.indexOf("right")>=0){const h=s.point({x:this.padding()*2,y:0});if(this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=h.x,this._anchorDragOffset.y-=h.y,t.width+=this.padding()*2,!n){this.update();return}}if(this._movingAnchorName&&t.height<0&&this._movingAnchorName.indexOf("top")>=0){const h=s.point({x:0,y:-this.padding()*2});if(t.x+=h.x,t.y+=h.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=h.x,this._anchorDragOffset.y-=h.y,t.height+=this.padding()*2,!n){this.update();return}}else if(this._movingAnchorName&&t.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const h=s.point({x:0,y:this.padding()*2});if(this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=h.x,this._anchorDragOffset.y-=h.y,t.height+=this.padding()*2,!n){this.update();return}}if(this.boundBoxFunc()){const h=this.boundBoxFunc()(o,t);h?t=h:c.Z.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const r=1e7,a=new c.w;a.translate(o.x,o.y),a.rotate(o.rotation),a.scale(o.width/r,o.height/r);const u=new c.w;u.translate(t.x,t.y),u.rotate(t.rotation),u.scale(t.width/r,t.height/r);const _=u.multiply(a.invert());this._nodes.forEach(h=>{var S;const y=h.getParent().getAbsoluteTransform(),g=h.getTransform().copy();g.translate(h.offsetX(),h.offsetY());const v=new c.w;v.multiply(y.copy().invert()).multiply(_).multiply(y).multiply(g);const p=v.decompose();h.setAttrs(p),this._fire("transform",{evt:e,target:h}),h._fire("transform",{evt:e,target:h}),(S=h.getLayer())===null||S===void 0||S.batchDraw()}),this.rotation(c.Z._getRotation(t.rotation)),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(t,e){this.findOne(t).setAttrs(e)}update(){var t,e=this._getNodeRect();this.rotation(c.Z._getRotation(e.rotation));var o=e.width,i=e.height,n=this.enabledAnchors(),s=this.resizeEnabled(),r=this.padding(),a=this.anchorSize();this.find("._anchor").forEach(u=>{u.setAttrs({width:a,height:a,offsetX:a/2,offsetY:a/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:a/2+r,offsetY:a/2+r,visible:s&&n.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:o/2,y:0,offsetY:a/2+r,visible:s&&n.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:o,y:0,offsetX:a/2-r,offsetY:a/2+r,visible:s&&n.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:i/2,offsetX:a/2+r,visible:s&&n.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:o,y:i/2,offsetX:a/2-r,visible:s&&n.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:i,offsetX:a/2+r,offsetY:a/2-r,visible:s&&n.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:o/2,y:i,offsetY:a/2-r,visible:s&&n.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:o,y:i,offsetX:a/2-r,offsetY:a/2-r,visible:s&&n.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:o/2,y:-this.rotateAnchorOffset()*c.Z._sign(i)-r,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:o,height:i,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0}),(t=this.getLayer())===null||t===void 0||t.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();var t=this.findOne("."+this._movingAnchorName);t&&t.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),M.Z.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return G.N.prototype.toObject.call(this)}getClientRect(){return{x:0,y:0,width:0,height:0}}}function j(d){return d instanceof Array||c.Z.warn("enabledAnchors value should be an array"),d instanceof Array&&d.forEach(function(t){A.indexOf(t)===-1&&c.Z.warn("Unknown anchor name: "+t+". Available names are: "+A.join(", "))}),d||[]}f.prototype.className="Transformer",(0,m.DA)(f),l.F.addGetterSetter(f,"enabledAnchors",A,j),l.F.addGetterSetter(f,"flipEnabled",!0,(0,x.I0)()),l.F.addGetterSetter(f,"resizeEnabled",!0),l.F.addGetterSetter(f,"anchorSize",10,(0,x.Kg)()),l.F.addGetterSetter(f,"rotateEnabled",!0),l.F.addGetterSetter(f,"rotationSnaps",[]),l.F.addGetterSetter(f,"rotateAnchorOffset",50,(0,x.Kg)()),l.F.addGetterSetter(f,"rotationSnapTolerance",5,(0,x.Kg)()),l.F.addGetterSetter(f,"borderEnabled",!0),l.F.addGetterSetter(f,"anchorStroke","rgb(0, 161, 255)"),l.F.addGetterSetter(f,"anchorStrokeWidth",1,(0,x.Kg)()),l.F.addGetterSetter(f,"anchorFill","white"),l.F.addGetterSetter(f,"anchorCornerRadius",0,(0,x.Kg)()),l.F.addGetterSetter(f,"borderStroke","rgb(0, 161, 255)"),l.F.addGetterSetter(f,"borderStrokeWidth",1,(0,x.Kg)()),l.F.addGetterSetter(f,"borderDash"),l.F.addGetterSetter(f,"keepRatio",!0),l.F.addGetterSetter(f,"centeredScaling",!1),l.F.addGetterSetter(f,"ignoreStroke",!1),l.F.addGetterSetter(f,"padding",0,(0,x.Kg)()),l.F.addGetterSetter(f,"node"),l.F.addGetterSetter(f,"nodes"),l.F.addGetterSetter(f,"boundBoxFunc"),l.F.addGetterSetter(f,"anchorDragBoundFunc"),l.F.addGetterSetter(f,"shouldOverdrawWholeArea",!1),l.F.addGetterSetter(f,"useSingleNodeRotation",!0),l.F.backCompat(f,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"})}}]);

//# sourceMappingURL=958c6018ca7.js.map